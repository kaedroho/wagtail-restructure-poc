From ea95eb95931b3d3e395bdb4b24f13e158b883e94 Mon Sep 17 00:00:00 2001
From: Karl Hobley <karl@torchbox.com>
Date: Fri, 1 Oct 2021 15:31:09 +0100
Subject: [PATCH 1/4] Create a UserProfile model in wagtailcore

---
 wagtail/core/migrations/0066_userprofile.py   | 35 ++++++++
 wagtail/core/models/__init__.py               |  1 +
 wagtail/core/models/user_profile.py           | 83 +++++++++++++++++++
 .../0011_userprofile_related_name_change.py   | 21 +++++
 wagtail/users/models.py                       |  2 +-
 5 files changed, 141 insertions(+), 1 deletion(-)
 create mode 100644 wagtail/core/migrations/0066_userprofile.py
 create mode 100644 wagtail/core/models/user_profile.py
 create mode 100644 wagtail/users/migrations/0011_userprofile_related_name_change.py

diff --git a/wagtail/core/migrations/0066_userprofile.py b/wagtail/core/migrations/0066_userprofile.py
new file mode 100644
index 00000000000..9c62e681ffb
--- /dev/null
+++ b/wagtail/core/migrations/0066_userprofile.py
@@ -0,0 +1,35 @@
+# Generated by Django 3.1.8 on 2021-10-01 12:44
+
+from django.conf import settings
+from django.db import migrations, models
+import django.db.models.deletion
+import wagtail.core.models.user_profile
+
+
+class Migration(migrations.Migration):
+
+    dependencies = [
+        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
+        ('wagtailcore', '0065_log_entry_uuid'),
+    ]
+
+    operations = [
+        migrations.CreateModel(
+            name='UserProfile',
+            fields=[
+                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
+                ('submitted_notifications', models.BooleanField(default=True, help_text='Receive notification when a page is submitted for moderation', verbose_name='submitted notifications')),
+                ('approved_notifications', models.BooleanField(default=True, help_text='Receive notification when your page edit is approved', verbose_name='approved notifications')),
+                ('rejected_notifications', models.BooleanField(default=True, help_text='Receive notification when your page edit is rejected', verbose_name='rejected notifications')),
+                ('updated_comments_notifications', models.BooleanField(default=True, help_text='Receive notification when comments have been created, resolved, or deleted on a page that you have subscribed to receive comment notifications on', verbose_name='updated comments notifications')),
+                ('preferred_language', models.CharField(default='', help_text='Select language for the admin', max_length=10, verbose_name='preferred language')),
+                ('current_time_zone', models.CharField(default='', help_text='Select your current time zone', max_length=40, verbose_name='current time zone')),
+                ('avatar', models.ImageField(blank=True, upload_to=wagtail.core.models.user_profile.upload_avatar_to, verbose_name='profile picture')),
+                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='wagtail_userprofile', to=settings.AUTH_USER_MODEL)),
+            ],
+            options={
+                'verbose_name': 'user profile',
+                'verbose_name_plural': 'user profiles',
+            },
+        ),
+    ]
diff --git a/wagtail/core/models/__init__.py b/wagtail/core/models/__init__.py
index f441d436701..d465132fe17 100644
--- a/wagtail/core/models/__init__.py
+++ b/wagtail/core/models/__init__.py
@@ -71,6 +71,7 @@
     BootstrapTranslatableMixin, BootstrapTranslatableModel, Locale, LocaleManager,
     TranslatableMixin, bootstrap_translatable_model, get_translatable_models)
 from .sites import Site, SiteManager, SiteRootPath  # noqa
+from .user_profile import UserProfile  # noqa
 from .view_restrictions import BaseViewRestriction
 
 
diff --git a/wagtail/core/models/user_profile.py b/wagtail/core/models/user_profile.py
new file mode 100644
index 00000000000..4e4929834c6
--- /dev/null
+++ b/wagtail/core/models/user_profile.py
@@ -0,0 +1,83 @@
+import os
+import uuid
+
+from django.conf import settings
+from django.db import models
+from django.utils.translation import get_language
+from django.utils.translation import gettext_lazy as _
+
+
+def upload_avatar_to(instance, filename):
+    filename, ext = os.path.splitext(filename)
+    return os.path.join(
+        'avatar_images',
+        'avatar_{uuid}_{filename}{ext}'.format(
+            uuid=uuid.uuid4(), filename=filename, ext=ext)
+    )
+
+
+class UserProfile(models.Model):
+    user = models.OneToOneField(
+        settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='wagtail_userprofile'
+    )
+
+    submitted_notifications = models.BooleanField(
+        verbose_name=_('submitted notifications'),
+        default=True,
+        help_text=_("Receive notification when a page is submitted for moderation")
+    )
+
+    approved_notifications = models.BooleanField(
+        verbose_name=_('approved notifications'),
+        default=True,
+        help_text=_("Receive notification when your page edit is approved")
+    )
+
+    rejected_notifications = models.BooleanField(
+        verbose_name=_('rejected notifications'),
+        default=True,
+        help_text=_("Receive notification when your page edit is rejected")
+    )
+
+    updated_comments_notifications = models.BooleanField(
+        verbose_name=_('updated comments notifications'),
+        default=True,
+        help_text=_("Receive notification when comments have been created, resolved, or deleted on a page that you have subscribed to receive comment notifications on")
+    )
+
+    preferred_language = models.CharField(
+        verbose_name=_('preferred language'),
+        max_length=10,
+        help_text=_("Select language for the admin"),
+        default=''
+    )
+
+    current_time_zone = models.CharField(
+        verbose_name=_('current time zone'),
+        max_length=40,
+        help_text=_("Select your current time zone"),
+        default=''
+    )
+
+    avatar = models.ImageField(
+        verbose_name=_('profile picture'),
+        upload_to=upload_avatar_to,
+        blank=True,
+    )
+
+    @classmethod
+    def get_for_user(cls, user):
+        return cls.objects.get_or_create(user=user)[0]
+
+    def get_preferred_language(self):
+        return self.preferred_language or get_language()
+
+    def get_current_time_zone(self):
+        return self.current_time_zone or settings.TIME_ZONE
+
+    def __str__(self):
+        return self.user.get_username()
+
+    class Meta:
+        verbose_name = _('user profile')
+        verbose_name_plural = _('user profiles')
diff --git a/wagtail/users/migrations/0011_userprofile_related_name_change.py b/wagtail/users/migrations/0011_userprofile_related_name_change.py
new file mode 100644
index 00000000000..230e97fc78c
--- /dev/null
+++ b/wagtail/users/migrations/0011_userprofile_related_name_change.py
@@ -0,0 +1,21 @@
+# Generated by Django 3.1.8 on 2021-10-01 12:44
+
+from django.conf import settings
+from django.db import migrations, models
+import django.db.models.deletion
+
+
+class Migration(migrations.Migration):
+
+    dependencies = [
+        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
+        ('wagtailusers', '0010_userprofile_updated_comments_notifications'),
+    ]
+
+    operations = [
+        migrations.AlterField(
+            model_name='userprofile',
+            name='user',
+            field=models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='wagtail_userprofile_legacy', to=settings.AUTH_USER_MODEL),
+        ),
+    ]
diff --git a/wagtail/users/models.py b/wagtail/users/models.py
index 4e4929834c6..fa4ad26310c 100644
--- a/wagtail/users/models.py
+++ b/wagtail/users/models.py
@@ -18,7 +18,7 @@ def upload_avatar_to(instance, filename):
 
 class UserProfile(models.Model):
     user = models.OneToOneField(
-        settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='wagtail_userprofile'
+        settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='wagtail_userprofile_legacy'
     )
 
     submitted_notifications = models.BooleanField(

From 4d42832c07e113c9e0c1cf8bdfb9b0703a6dcb08 Mon Sep 17 00:00:00 2001
From: Karl Hobley <karl@torchbox.com>
Date: Fri, 1 Oct 2021 15:31:30 +0100
Subject: [PATCH 2/4] Add a migration to migrate from wagtailusers

---
 .../core/migrations/0067_copy_userprofiles.py | 38 +++++++++++++++++++
 .../0011_userprofile_related_name_change.py   |  7 ++++
 2 files changed, 45 insertions(+)
 create mode 100644 wagtail/core/migrations/0067_copy_userprofiles.py

diff --git a/wagtail/core/migrations/0067_copy_userprofiles.py b/wagtail/core/migrations/0067_copy_userprofiles.py
new file mode 100644
index 00000000000..0d77fdf7d23
--- /dev/null
+++ b/wagtail/core/migrations/0067_copy_userprofiles.py
@@ -0,0 +1,38 @@
+# Generated by Django 3.1.8 on 2021-10-01 12:47
+
+from django.db import migrations
+
+
+def copy_userprofiles(apps, schema_editor):
+    if not apps.is_installed('wagtailusers'):
+        return
+
+    UserProfile = apps.get_model('wagtailcore.UserProfile')
+    OldUserProfile = apps.get_model('wagtailusers.UserProfile')
+    UserProfile.objects.bulk_create(
+        [
+            UserProfile(
+                user_id=user_profile.user_id,
+                submitted_notifications=user_profile.submitted_notifications,
+                approved_notifications=user_profile.approved_notifications,
+                rejected_notifications=user_profile.rejected_notifications,
+                updated_comments_notifications=user_profile.updated_comments_notifications,
+                preferred_language=user_profile.preferred_language,
+                current_time_zone=user_profile.current_time_zone,
+                avatar=user_profile.avatar,  # TODO does this copy the avatar?
+            )
+            for user_profile in OldUserProfile.objects.all()
+        ],
+        ignore_conflicts=True
+    )
+
+
+class Migration(migrations.Migration):
+
+    dependencies = [
+        ('wagtailcore', '0066_userprofile'),
+    ]
+
+    operations = [
+        migrations.RunPython(copy_userprofiles, migrations.RunPython.noop),
+    ]
diff --git a/wagtail/users/migrations/0011_userprofile_related_name_change.py b/wagtail/users/migrations/0011_userprofile_related_name_change.py
index 230e97fc78c..3c9b095bdea 100644
--- a/wagtail/users/migrations/0011_userprofile_related_name_change.py
+++ b/wagtail/users/migrations/0011_userprofile_related_name_change.py
@@ -12,6 +12,13 @@ class Migration(migrations.Migration):
         ('wagtailusers', '0010_userprofile_updated_comments_notifications'),
     ]
 
+    # This migration is a dependency of '0067_copy_userprofiles',
+    # but we don't want to add this as a hard-dependency in that
+    # migration in case wagtailusers is not installed.
+    run_before = [
+        ('wagtailcore', '0067_copy_userprofiles'),
+    ]
+
     operations = [
         migrations.AlterField(
             model_name='userprofile',

From 4f29680c521c364c46a274ce29e523fe4d8ec117 Mon Sep 17 00:00:00 2001
From: Karl Hobley <karl@torchbox.com>
Date: Fri, 1 Oct 2021 15:36:58 +0100
Subject: [PATCH 3/4] Switch to new UserProfile model

---
 docs/extending/custom_account_settings.rst          | 6 +++---
 wagtail/admin/forms/account.py                      | 3 +--
 wagtail/admin/mail.py                               | 3 +--
 wagtail/admin/templatetags/wagtailuserbar.py        | 3 +--
 wagtail/admin/tests/api/test_pages.py               | 3 +--
 wagtail/admin/tests/pages/test_edit_page.py         | 3 +--
 wagtail/admin/tests/pages/test_moderation.py        | 3 +--
 wagtail/admin/tests/test_account_management.py      | 2 +-
 wagtail/admin/tests/test_templatetags.py            | 2 +-
 wagtail/admin/tests/test_workflows.py               | 4 ++--
 wagtail/admin/views/account.py                      | 3 +--
 wagtail/users/migrations/0008_userprofile_avatar.py | 4 ++--
 wagtail/users/tests.py                              | 4 ++--
 13 files changed, 18 insertions(+), 25 deletions(-)

diff --git a/docs/extending/custom_account_settings.rst b/docs/extending/custom_account_settings.rst
index dae09c66869..eb72833e53c 100644
--- a/docs/extending/custom_account_settings.rst
+++ b/docs/extending/custom_account_settings.rst
@@ -8,7 +8,7 @@ Adding new panels
 -----------------
 
 Each panel on this form is a separate model form which can operate on an instance of either the user model, or the
-:class:`~wagtail.users.models.UserProfile` model.
+:class:`~wagtail.core.models.UserProfile` model.
 
 Basic example
 ~~~~~~~~~~~~~
@@ -58,7 +58,7 @@ The attributes are as follows:
 Operating on the ``UserProfile`` model
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
-To add a panel that alters data on the user's :class:`~wagtail.users.models.UserProfile` instance, set ``form_object`` to ``'profile'``:
+To add a panel that alters data on the user's :class:`~wagtail.core.models.UserProfile` instance, set ``form_object`` to ``'profile'``:
 
 
   .. code-block:: python
@@ -66,7 +66,7 @@ To add a panel that alters data on the user's :class:`~wagtail.users.models.User
     # forms.py
 
     from django import forms
-    from wagtail.users.models import UserProfile
+    from wagtail.core.models import UserProfile
 
     class CustomProfileSettingsForm(forms.ModelForm):
 
diff --git a/wagtail/admin/forms/account.py b/wagtail/admin/forms/account.py
index 7745d4d9503..020742ce406 100644
--- a/wagtail/admin/forms/account.py
+++ b/wagtail/admin/forms/account.py
@@ -12,8 +12,7 @@
 
 from wagtail.admin.localization import get_available_admin_languages, get_available_admin_time_zones
 from wagtail.admin.widgets import SwitchInput
-from wagtail.core.models import UserPagePermissionsProxy
-from wagtail.users.models import UserProfile
+from wagtail.core.models import UserPagePermissionsProxy, UserProfile
 
 
 User = get_user_model()
diff --git a/wagtail/admin/mail.py b/wagtail/admin/mail.py
index a5d1f00b361..679fe355243 100644
--- a/wagtail/admin/mail.py
+++ b/wagtail/admin/mail.py
@@ -8,9 +8,8 @@
 from django.utils.translation import override
 
 from wagtail.admin.auth import users_with_page_permission
-from wagtail.core.models import GroupApprovalTask, TaskState, WorkflowState
+from wagtail.core.models import GroupApprovalTask, TaskState, UserProfile, WorkflowState
 from wagtail.core.utils import camelcase_to_underscore
-from wagtail.users.models import UserProfile
 
 
 logger = logging.getLogger('wagtail.admin')
diff --git a/wagtail/admin/templatetags/wagtailuserbar.py b/wagtail/admin/templatetags/wagtailuserbar.py
index 0f4bec3eb6a..2085dd128ef 100644
--- a/wagtail/admin/templatetags/wagtailuserbar.py
+++ b/wagtail/admin/templatetags/wagtailuserbar.py
@@ -6,8 +6,7 @@
     AddPageItem, AdminItem, ApproveModerationEditPageItem, EditPageItem, ExplorePageItem,
     RejectModerationEditPageItem)
 from wagtail.core import hooks
-from wagtail.core.models import PAGE_TEMPLATE_VAR, Page, PageRevision
-from wagtail.users.models import UserProfile
+from wagtail.core.models import PAGE_TEMPLATE_VAR, Page, PageRevision, UserProfile
 
 
 register = template.Library()
diff --git a/wagtail/admin/tests/api/test_pages.py b/wagtail/admin/tests/api/test_pages.py
index a77d1b123af..3aba28b171d 100644
--- a/wagtail/admin/tests/api/test_pages.py
+++ b/wagtail/admin/tests/api/test_pages.py
@@ -8,10 +8,9 @@
 
 from wagtail.api.v2.tests.test_pages import TestPageDetail, TestPageListing
 from wagtail.core import hooks
-from wagtail.core.models import Locale, Page
+from wagtail.core.models import Locale, Page, UserProfile
 from wagtail.tests.demosite import models
 from wagtail.tests.testapp.models import SimplePage, StreamPage
-from wagtail.users.models import UserProfile
 
 from .utils import AdminAPITestCase
 
diff --git a/wagtail/admin/tests/pages/test_edit_page.py b/wagtail/admin/tests/pages/test_edit_page.py
index 7eab6481da2..275ab2e046b 100644
--- a/wagtail/admin/tests/pages/test_edit_page.py
+++ b/wagtail/admin/tests/pages/test_edit_page.py
@@ -18,7 +18,7 @@
 from wagtail.core.exceptions import PageClassNotFoundError
 from wagtail.core.models import (
     Comment, CommentReply, GroupPagePermission, Locale, Page, PageLogEntry, PageRevision,
-    PageSubscription, Site)
+    PageSubscription, Site, UserProfile)
 from wagtail.core.signals import page_published
 from wagtail.tests.testapp.models import (
     EVENT_AUDIENCE_CHOICES, Advert, AdvertPlacement, EventCategory, EventPage,
@@ -26,7 +26,6 @@
     TaggedPage)
 from wagtail.tests.utils import WagtailTestUtils
 from wagtail.tests.utils.form_data import inline_formset, nested_form_data
-from wagtail.users.models import UserProfile
 
 
 class TestPageEdit(TestCase, WagtailTestUtils):
diff --git a/wagtail/admin/tests/pages/test_moderation.py b/wagtail/admin/tests/pages/test_moderation.py
index becbc586600..a77c24d5ad7 100644
--- a/wagtail/admin/tests/pages/test_moderation.py
+++ b/wagtail/admin/tests/pages/test_moderation.py
@@ -10,11 +10,10 @@
 from django.test import TestCase, override_settings
 from django.urls import reverse
 
-from wagtail.core.models import Page, PageRevision
+from wagtail.core.models import Page, PageRevision, UserProfile
 from wagtail.core.signals import page_published
 from wagtail.tests.testapp.models import SimplePage
 from wagtail.tests.utils import WagtailTestUtils
-from wagtail.users.models import UserProfile
 
 
 class TestApproveRejectModeration(TestCase, WagtailTestUtils):
diff --git a/wagtail/admin/tests/test_account_management.py b/wagtail/admin/tests/test_account_management.py
index 94ddd2e8666..ea758a33f07 100644
--- a/wagtail/admin/tests/test_account_management.py
+++ b/wagtail/admin/tests/test_account_management.py
@@ -15,9 +15,9 @@
 from wagtail.admin.localization import (
     WAGTAILADMIN_PROVIDED_LANGUAGES, get_available_admin_languages, get_available_admin_time_zones)
 from wagtail.admin.views.account import account, profile_tab
+from wagtail.core.models import UserProfile
 from wagtail.images.tests.utils import get_test_image_file
 from wagtail.tests.utils import WagtailTestUtils
-from wagtail.users.models import UserProfile
 
 
 class TestAuthentication(TestCase, WagtailTestUtils):
diff --git a/wagtail/admin/tests/test_templatetags.py b/wagtail/admin/tests/test_templatetags.py
index 96aaafed07c..2381da9d775 100644
--- a/wagtail/admin/tests/test_templatetags.py
+++ b/wagtail/admin/tests/test_templatetags.py
@@ -13,9 +13,9 @@
 from wagtail.admin.templatetags.wagtailadmin_tags import (
     avatar_url, notification_static, timesince_last_update, timesince_simple)
 from wagtail.admin.ui.components import Component
+from wagtail.core.models import UserProfile
 from wagtail.images.tests.utils import get_test_image_file
 from wagtail.tests.utils import WagtailTestUtils
-from wagtail.users.models import UserProfile
 
 
 class TestAvatarTemplateTag(TestCase, WagtailTestUtils):
diff --git a/wagtail/admin/tests/test_workflows.py b/wagtail/admin/tests/test_workflows.py
index e6ac9a433ac..cdefd3c7746 100644
--- a/wagtail/admin/tests/test_workflows.py
+++ b/wagtail/admin/tests/test_workflows.py
@@ -13,11 +13,11 @@
 
 from wagtail.admin.admin_url_finder import AdminURLFinder
 from wagtail.core.models import (
-    GroupApprovalTask, Page, Task, TaskState, Workflow, WorkflowPage, WorkflowState, WorkflowTask)
+    GroupApprovalTask, Page, Task, TaskState, UserProfile, Workflow, WorkflowPage, WorkflowState,
+    WorkflowTask)
 from wagtail.core.signals import page_published
 from wagtail.tests.testapp.models import SimplePage, SimpleTask
 from wagtail.tests.utils import WagtailTestUtils
-from wagtail.users.models import UserProfile
 
 
 def delete_existing_workflows():
diff --git a/wagtail/admin/views/account.py b/wagtail/admin/views/account.py
index c6650ca0b03..be985f6d573 100644
--- a/wagtail/admin/views/account.py
+++ b/wagtail/admin/views/account.py
@@ -21,8 +21,7 @@
 from wagtail.admin.localization import get_available_admin_languages, get_available_admin_time_zones
 from wagtail.core import hooks
 from wagtail.core.log_actions import log
-from wagtail.core.models import UserPagePermissionsProxy
-from wagtail.users.models import UserProfile
+from wagtail.core.models import UserPagePermissionsProxy, UserProfile
 from wagtail.utils.loading import get_custom_form
 
 
diff --git a/wagtail/users/migrations/0008_userprofile_avatar.py b/wagtail/users/migrations/0008_userprofile_avatar.py
index 683765623a7..613300ccf05 100644
--- a/wagtail/users/migrations/0008_userprofile_avatar.py
+++ b/wagtail/users/migrations/0008_userprofile_avatar.py
@@ -1,7 +1,7 @@
 # Generated by Django 2.0 on 2018-01-17 01:03
 
 from django.db import migrations, models
-import wagtail.users.models
+import wagtail.core.models.user_profile
 
 
 class Migration(migrations.Migration):
@@ -14,6 +14,6 @@ class Migration(migrations.Migration):
         migrations.AddField(
             model_name='userprofile',
             name='avatar',
-            field=models.ImageField(blank=True, upload_to=wagtail.users.models.upload_avatar_to, verbose_name='profile picture'),
+            field=models.ImageField(blank=True, upload_to=wagtail.core.models.user_profile.upload_avatar_to, verbose_name='profile picture'),
         ),
     ]
diff --git a/wagtail/users/tests.py b/wagtail/users/tests.py
index af74575fc91..843b11de110 100644
--- a/wagtail/users/tests.py
+++ b/wagtail/users/tests.py
@@ -15,10 +15,10 @@
 from wagtail.admin.admin_url_finder import AdminURLFinder
 from wagtail.core import hooks
 from wagtail.core.compat import AUTH_USER_APP_LABEL, AUTH_USER_MODEL_NAME
-from wagtail.core.models import Collection, GroupCollectionPermission, GroupPagePermission, Page
+from wagtail.core.models import (
+    Collection, GroupCollectionPermission, GroupPagePermission, Page, UserProfile)
 from wagtail.tests.utils import WagtailTestUtils
 from wagtail.users.forms import UserCreationForm, UserEditForm
-from wagtail.users.models import UserProfile
 from wagtail.users.views.groups import GroupViewSet
 from wagtail.users.views.users import get_user_creation_form, get_user_edit_form
 from wagtail.users.wagtail_hooks import get_group_viewset_cls

From a5f321502ff434fe62f9f78a109d5dcc6a402a03 Mon Sep 17 00:00:00 2001
From: Karl Hobley <karl@torchbox.com>
Date: Fri, 1 Oct 2021 15:35:38 +0100
Subject: [PATCH 4/4] Delete wagtailusers UserProfile model

---
 .../migrations/0012_delete_userprofile.py     | 17 ++++
 wagtail/users/models.py                       | 83 -------------------
 2 files changed, 17 insertions(+), 83 deletions(-)
 create mode 100644 wagtail/users/migrations/0012_delete_userprofile.py
 delete mode 100644 wagtail/users/models.py

diff --git a/wagtail/users/migrations/0012_delete_userprofile.py b/wagtail/users/migrations/0012_delete_userprofile.py
new file mode 100644
index 00000000000..dc2a5ad48cb
--- /dev/null
+++ b/wagtail/users/migrations/0012_delete_userprofile.py
@@ -0,0 +1,17 @@
+# Generated by Django 3.1.8 on 2021-10-01 14:35
+
+from django.db import migrations
+
+
+class Migration(migrations.Migration):
+
+    dependencies = [
+        ('wagtailusers', '0011_userprofile_related_name_change'),
+        ('wagtailcore', '0067_copy_userprofiles'),
+    ]
+
+    operations = [
+        migrations.DeleteModel(
+            name='UserProfile',
+        ),
+    ]
diff --git a/wagtail/users/models.py b/wagtail/users/models.py
deleted file mode 100644
index fa4ad26310c..00000000000
--- a/wagtail/users/models.py
+++ /dev/null
@@ -1,83 +0,0 @@
-import os
-import uuid
-
-from django.conf import settings
-from django.db import models
-from django.utils.translation import get_language
-from django.utils.translation import gettext_lazy as _
-
-
-def upload_avatar_to(instance, filename):
-    filename, ext = os.path.splitext(filename)
-    return os.path.join(
-        'avatar_images',
-        'avatar_{uuid}_{filename}{ext}'.format(
-            uuid=uuid.uuid4(), filename=filename, ext=ext)
-    )
-
-
-class UserProfile(models.Model):
-    user = models.OneToOneField(
-        settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='wagtail_userprofile_legacy'
-    )
-
-    submitted_notifications = models.BooleanField(
-        verbose_name=_('submitted notifications'),
-        default=True,
-        help_text=_("Receive notification when a page is submitted for moderation")
-    )
-
-    approved_notifications = models.BooleanField(
-        verbose_name=_('approved notifications'),
-        default=True,
-        help_text=_("Receive notification when your page edit is approved")
-    )
-
-    rejected_notifications = models.BooleanField(
-        verbose_name=_('rejected notifications'),
-        default=True,
-        help_text=_("Receive notification when your page edit is rejected")
-    )
-
-    updated_comments_notifications = models.BooleanField(
-        verbose_name=_('updated comments notifications'),
-        default=True,
-        help_text=_("Receive notification when comments have been created, resolved, or deleted on a page that you have subscribed to receive comment notifications on")
-    )
-
-    preferred_language = models.CharField(
-        verbose_name=_('preferred language'),
-        max_length=10,
-        help_text=_("Select language for the admin"),
-        default=''
-    )
-
-    current_time_zone = models.CharField(
-        verbose_name=_('current time zone'),
-        max_length=40,
-        help_text=_("Select your current time zone"),
-        default=''
-    )
-
-    avatar = models.ImageField(
-        verbose_name=_('profile picture'),
-        upload_to=upload_avatar_to,
-        blank=True,
-    )
-
-    @classmethod
-    def get_for_user(cls, user):
-        return cls.objects.get_or_create(user=user)[0]
-
-    def get_preferred_language(self):
-        return self.preferred_language or get_language()
-
-    def get_current_time_zone(self):
-        return self.current_time_zone or settings.TIME_ZONE
-
-    def __str__(self):
-        return self.user.get_username()
-
-    class Meta:
-        verbose_name = _('user profile')
-        verbose_name_plural = _('user profiles')
