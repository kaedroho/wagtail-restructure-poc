From da19df7d4da28e884d42460885336a5a7f79dd24 Mon Sep 17 00:00:00 2001
From: Karl Hobley <karl@torchbox.com>
Date: Thu, 28 Oct 2021 14:34:24 +0100
Subject: [PATCH] allow group_viewset to be specified on WAgtailAppConfig

---
 wagtail/apps.py                | 1 +
 wagtail/wagtail_hooks/users.py | 6 +++++-
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/wagtail/apps.py b/wagtail/apps.py
index 1f182f852..a400b3742 100644
--- a/wagtail/apps.py
+++ b/wagtail/apps.py
@@ -7,6 +7,7 @@ class WagtailAppConfig(AppConfig):
     label = 'wagtailcore'
     verbose_name = _("Wagtail core")
     default_auto_field = 'django.db.models.AutoField'
+    group_viewset = 'wagtail.admin.views.groups.GroupViewSet'
 
     def ready(self):
         from wagtail.admin.signal_handlers import \
diff --git a/wagtail/wagtail_hooks/users.py b/wagtail/wagtail_hooks/users.py
index 1d45608c9..d77b0a224 100644
--- a/wagtail/wagtail_hooks/users.py
+++ b/wagtail/wagtail_hooks/users.py
@@ -40,7 +40,11 @@ def get_group_viewset_cls(app_config):
 
 @hooks.register('register_admin_viewset')
 def register_viewset():
-    app_config = apps.get_app_config("wagtailusers")
+    try:
+        app_config = apps.get_app_config("wagtailusers")
+    except LookupError:
+        app_config = apps.get_app_config("wagtailcore")
+
     group_viewset_cls = get_group_viewset_cls(app_config)
     return group_viewset_cls('wagtailusers_groups', url_prefix='groups')
 
-- 
2.30.2

